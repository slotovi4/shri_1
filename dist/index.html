<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="robots" content="noindex">
    <link rel="stylesheet" href="css/main.min.css">
    <title>Document</title>
</head>

<body>

    <header class="header">
        <div class="header__logo"></div>
        <div class="header__menu">
            <a class="header__link header__link_active" href="#">События</a>
            <a class="header__link" href="#">Сводка</a>
            <a class="header__link" href="#">Устройства</a>
            <a class="header__link" href="#">Сценарии</a>
        </div>
    </header>

    <main class="container">
        <h1 class="container__title">Лента событий</h1>
    </main>

    <footer class="footer">
        <div class="footer__left-section">
            <a href="#" class="footer__text">Помощь</a>
            <a href="#" class="footer__text">Обратная связь</a>
            <a href="#" class="footer__text">Разработчикам</a>
            <a href="#" class="footer__text">Условия использования</a>
            <a href="license.pdf" class="footer__text">Лицензия</a>
        </div>
        <div class="footer__right-section">
            <span class="footer__text">© 2001–2017 ООО «Яндекс»</span>
        </div>
    </footer>

    <script>
        let request = new XMLHttpRequest();
        request.open('GET', 'events.json', true);

        request.onload = function () {
            if (request.status >= 200 && request.status < 400) {
                let data = JSON.parse(request.responseText);
                let events = data.events;

                events.forEach(function (el) {
                    /* Get Data */
                    let type = el.type,
                        title = el.title,
                        source = el.source,
                        time = el.time,
                        description = el.description,
                        icon = el.icon,
                        size = el.size,
                        data = el.data;

                    /* Template */
                    let content = document.querySelector('template').content,
                        block = content.querySelector('#event'),
                        blockIcon = content.querySelector('.event__icon'),
                        blockTitle = content.querySelector('.event__title'),
                        blockSource = content.querySelector('.event__source'),
                        blockTime = content.querySelector('.event__time'),
                        blockDesc = content.querySelector('.event__desc'),
                        blockClose = content.querySelector('.event__close'),
                        blockImage = content.querySelector('.event__image'),
                        blockTemp = content.querySelector('.event__temperature'),
                        blockHumi = content.querySelector('.event__humidity'),
                        blockClimate = content.querySelector('.event-climate'),
                        blockMusic = content.querySelector('.event-music'),
                        blockMusImg = content.querySelector('.event-music__image'),
                        blockMusName = content.querySelector('.event-music__name'),
                        blockMusTime = content.querySelector('.event-music__time'),
                        blockMusVolume = content.querySelector('.event-music-controlls__volume-value'),
                        blockButt = content.querySelector('.event-buttons'),
                        blockButtAct = content.querySelector('.event-buttons__button_active'),
                        blockButtIna = content.querySelector('.event-buttons__button_inactive'),
                        blockInfo = content.querySelector('.event-info');

                    /* Custom Data */
                    //hide blocks
                    blockImage.classList.add('event__image_hide');
                    blockClimate.classList.add('event-climate_hide');
                    blockMusic.classList.add('event-music_hide');
                    blockButt.classList.add('event-buttons_hide');

                    if (data) {
                        let dType = data.type,
                            dTemp = data.temperature,
                            dHumi = data.humidity,
                            dAlbum = data.albumcover,
                            dArtist = data.artist,
                            dTrack = data.track,
                            dVolume = data.volume,
                            dButton = data.buttons,
                            dImage = data.image;

                        /* Temporary Solution */
                        //Image
                        if (dType == 'graph') {
                            blockImage.setAttribute('src', 'img/graph.png');
                            blockImage.setAttribute('alt', 'graph');
                            blockImage.classList.remove('event__image_hide');
                        } else if (dImage == 'get_it_from_mocks_:3.jpg') {
                            blockImage.setAttribute('src', 'img/image.jpg');
                            blockImage.setAttribute('alt', 'image.jpg');
                            blockImage.classList.remove('event__image_hide');
                        }

                        //Climate
                        if (dTemp) blockTemp.innerHTML = 'Температура: <b>' + dTemp + ' C</b>';
                        if (dHumi) blockHumi.innerHTML = 'Влажность: <b>' + dHumi + '%</b>';
                        if (dTemp || dHumi) blockClimate.classList.remove('event-climate_hide'); //show event climate block

                        //Music
                        if (dTrack) {
                            let dLength = data.track.length,
                                dName = data.track.name;

                            if (dAlbum) blockMusImg.style.backgroundImage = 'url(' + dAlbum + ')';
                            if (dName) blockMusName.textContent = dArtist + ' - ' + dName;
                            if (dLength) blockMusTime.textContent = dLength;
                            if (dVolume) blockMusVolume.textContent = dVolume + '%';

                            blockMusic.classList.remove('event-music_hide'); //show event music block
                        }

                        //Buttons
                        if (dButton) {
                            if (dButton[0]) blockButtAct.textContent = dButton[0];
                            if (dButton[1]) blockButtIna.textContent = dButton[1];

                            blockButt.classList.remove('event-buttons_hide'); //show event buttons block
                        }
                    }

                    /* Fill Template */
                    block.className = 'event event_size-' + size + ' event_type-' + type;
                    blockIcon.setAttribute('src', 'img/' + icon + '.svg');
                    blockIcon.setAttribute('alt', icon);
                    blockClose.className = 'event__close event__close_type-' + type;
                    blockTitle.textContent = title;
                    blockSource.textContent = source;
                    blockTime.textContent = time;
                    blockDesc.textContent = description;

                    //hide event info block if empry data
                    !description ? blockInfo.classList.add('event-info_hide') : blockInfo.classList.remove('event-info_hide');

                    document.querySelector('.container').appendChild(content.cloneNode(true));
                });

            } else {
                throw "Error: data not received";
            }
        };

        request.send();
    </script>

    <template>
        <div id="event" class="event">
            <div class="event__close"></div>
            <div class="event-header">
                <img class="event__icon" src="" alt="">
                <h3 class="event__title"></h3>
            </div>

            <div class="event-system">
                <span class="event__source"></span>
                <span class="event__time"></span>
            </div>

            <div class="event-info">
                <span class="event__desc"></span>
                <div class="event-climate">
                    <span class="event__temperature"></span>
                    <span class="event__humidity"></span>
                </div>
                <div class="event-music">
                    <div class="event-music-tracker">
                        <div class="event-music__image"></div>
                        <span class="event-music__name"></span>
                        <div class="event-music__track"></div>
                        <span class="event-music__time"></span>
                    </div>

                    <div class="event-music-controlls">
                        <div class="event-music-controlls__prev"></div>
                        <div class="event-music-controlls__next"></div>
                        <div class="event-music-controlls__volume"></div>
                        <div class="event-music-controlls__volume-value"></div>
                    </div>
                </div>
                <div class="event-buttons">
                    <span class="event-buttons__button event-buttons__button_active"></span>
                    <span class="event-buttons__button event-buttons__button_inactive"></span>
                </div>
                <img class="event__image" src="" alt="">
            </div>

            <div class="event__continue"></div>
        </div>
    </template>
</body>

</html>