<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="robots" content="noindex">
    <link rel="stylesheet" href="css/main.min.css">
    <title>Document</title>
</head>

<body>

    <header class="header">
        <div class="header__logo"></div>
        <div class="header__menu">
            <a class="header__link header__link_active" href="#">События</a>
            <a class="header__link" href="#">Сводка</a>
            <a class="header__link" href="#">Устройства</a>
            <a class="header__link" href="#">Сценарии</a>
        </div>
    </header>

    <main class="container">
        <h1 class="container__title">Лента событий</h1>

    </main>

    <script>
        let request = new XMLHttpRequest();
        request.open('GET', 'events.json', true);

        request.onload = function () {
            if (request.status >= 200 && request.status < 400) {
                let data = JSON.parse(request.responseText);
                let events = data.events;

                events.forEach(function (el) {
                    /* Get Data */
                    let type = el.type,
                        title = el.title,
                        source = el.source,
                        time = el.time,
                        description = el.description,
                        icon = el.icon,
                        size = el.size,
                        data = el.data;

                    /* Template */
                    let content = document.querySelector('template').content,
                        block = content.querySelector('#event'),
                        blockIcon = content.querySelector('.event__icon'),
                        blockTitle = content.querySelector('.event__title'),
                        blockSource = content.querySelector('.event__source'),
                        blockTime = content.querySelector('.event__time'),
                        blockDesc = content.querySelector('.event__desc'),
                        blockClose = content.querySelector('.event__close'),
                        blockImage = content.querySelector('.event__image'),
                        blockInfo = content.querySelector('.event-info');

                    /* Custom Data */
                    blockImage.setAttribute('src', '');
                    blockImage.setAttribute('alt', '');

                    if (data) {
                        let dType = data.type;

                        /*!!! Temporary Solution*/
                        if (dType == 'graph') {
                            blockImage.setAttribute('src', 'img/graph.png');
                            blockImage.setAttribute('alt', 'graph');
                        }
                    }

                    /* Fill Template */
                    block.className = 'event event_size-' + size + ' event_type-' + type;
                    blockIcon.setAttribute('src', 'img/' + icon + '.svg');
                    blockIcon.setAttribute('alt', icon);
                    blockClose.className = 'event__close event__close_type-' + type;
                    blockTitle.textContent = title;
                    blockSource.textContent = source;
                    blockTime.textContent = time;
                    blockDesc.textContent = description;

                    //hide event info block if empry data
                    !description ? blockInfo.classList.add('event-info_hide') : blockInfo.classList.remove('event-info_hide');


                    document.querySelector('.container').appendChild(content.cloneNode(true));
                });

            } else {
                throw "Error: data not received";
            }
        };

        request.send();
    </script>

    <template>
        <div id="event" class="event">
            <div class="event__close"></div>
            <div class="event-header">
                <img class="event__icon" src="" alt="">
                <h3 class="event__title"></h3>
            </div>

            <div class="event-system">
                <span class="event__source"></span>
                <span class="event__time"></span>
            </div>

            <div class="event-info">
                <span class="event__desc"></span>
                <img class="event__image" src="" alt="">
            </div>

            <div class="event__continue"></div>
        </div>
    </template>
</body>

</html>