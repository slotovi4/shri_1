function templateEngine(e){let t=new XMLHttpRequest;t.open("GET",e,!1),t.onload=function(){if(200>t.status||t.status>=400)throw"Error: data not received";{let e=JSON.parse(t.responseText),n=e.events;n.forEach(function(e){let t=e.type,n=e.title,o=e.source,c=e.time,i=e.description,a=e.icon,s=e.size,l=e.data,d=document.querySelector("template").content,r=d.querySelector("#event"),u=d.querySelector(".event__icon"),v=d.querySelector(".event__title"),m=d.querySelector(".event__source"),_=d.querySelector(".event__time"),p=d.querySelector(".event__desc"),b=d.querySelector(".event__close"),h=d.querySelector(".event__image"),f=d.querySelector(".event__temperature"),y=d.querySelector(".event__humidity"),g=d.querySelector(".event-climate"),k=d.querySelector(".event-music"),L=d.querySelector(".event-music__image"),S=d.querySelector(".event-music__name"),q=d.querySelector(".event-music__time"),C=d.querySelector(".event-music-controlls__volume-value"),E=d.querySelector(".event-buttons"),x=d.querySelector(".event-buttons__button_active"),w=d.querySelector(".event-buttons__button_inactive"),A=d.querySelector(".event-cam-info"),I=d.querySelector(".event-cam__image"),M=d.querySelector(".event-info");if(h.classList.add("event__image_hide"),g.classList.add("event-climate_hide"),k.classList.add("event-music_hide"),E.classList.add("event-buttons_hide"),I.classList.add("event-cam__image_hide"),I.removeAttribute("id"),A.classList.add("event-cam-info_hide"),l){let e=l.type,t=l.temperature,n=l.humidity,o=l.albumcover,c=l.artist,i=l.track,a=l.volume,s=l.buttons,d=l.image;if("graph"==e?(h.setAttribute("src","img/graph.png"),h.setAttribute("alt","graph"),h.classList.remove("event__image_hide")):"get_it_from_mocks_:3.jpg"==d&&(I.id="cam",I.style.backgroundImage="url(img/image.jpg)",I.classList.remove("event-cam__image_hide")),t&&(f.innerHTML="Температура: <b>"+t+" C</b>"),n&&(y.innerHTML="Влажность: <b>"+n+"%</b>"),(t||n)&&g.classList.remove("event-climate_hide"),i){let e=l.track.length,t=l.track.name;o&&(L.style.backgroundImage="url("+o+")"),t&&(S.textContent=c+" - "+t),e&&(q.textContent=e),a&&(C.textContent=a+"%"),k.classList.remove("event-music_hide")}s&&(s[0]&&(x.textContent=s[0]),s[1]&&(w.textContent=s[1]),E.classList.remove("event-buttons_hide"))}r.className="event event_size-"+s+" event_type-"+t,u.setAttribute("src","img/"+a+".svg"),u.setAttribute("alt",a),b.className="event__close event__close_type-"+t,v.textContent=n,m.textContent=o,_.textContent=c,p.textContent=i,i?M.classList.remove("event-info_hide"):M.classList.add("event-info_hide"),document.querySelector(".container").appendChild(d.cloneNode(!0))})}},t.send(),200!=t.status?alert(t.status+": "+t.statusText):touchEvets()}function touchEvets(){if("ontouchstart"in document.documentElement){let c=document.querySelector("#cam"),i=c.parentElement.parentElement,a=i.querySelector(".event-cam-info"),s=a.querySelector(".event-cam-info__zoom"),l=a.querySelector(".event-cam-info__bright");a.classList.remove("event-cam-info_hide"),s.textContent="Приближение: 0%",l.textContent="Яркость: 0%";let d,r,u,v,m,_,p,b,h,f=[],y=-1,g=!1,k=0;window.PointerEvent?(c.addEventListener("pointerdown",e,!1),c.addEventListener("pointermove",t,!1),c.addEventListener("pointerup",n,!1)):(c.on("pointerdown",e),c.on("pointermove",t),c.on("pointerup",n));function e(e){d=e.clientX,r=parseInt(this.style.backgroundPositionX),e.move=!1,f.push(e),u=this.getBoundingClientRect().left,v=this.getBoundingClientRect().right,m=this.getBoundingClientRect().top,_=this.getBoundingClientRect().bottom,imgWight=parseInt(v-u),imgHeight=parseInt(_-m),p=parseInt((u+v)/2),b=parseInt((m+_)/2)}function t(e){for(let t=0;t<f.length;t++)if(f[t].pointerId==e.pointerId&&Math.abs(e.clientX-f[t].clientX)>50){e.move=!0,f[t]=e;break}if(2>f.length){let t=e.clientX,n=parseInt(t-d);this.style.backgroundPositionX=r?r+n+"px":n+"px"}else if(2==f.length){let t=o(e);if(!0!==t||g){g=!0;let e=Math.abs(f[0].clientX-f[1].clientX);y>0&&(e>y&&(0==k&&(k=1,this.style.transform="scale(1.5)",s.textContent="Приближение: 50%"),-1==k&&(k=0,this.style.transform="scale(1)",s.textContent="Приближение: 0%")),y>e&&(0==k&&(k=-1,this.style.transform="scale(0.7)",s.textContent="Приближение: -30%"),1==k&&(k=0,this.style.transform="scale(1)",s.textContent="Приближение: 0%"))),y=e}else(h=parseInt(Math.atan2(e.clientX-p,-(e.clientY-b))*(180/Math.PI)))>0&&(this.style.filter="brightness("+h+"%)",l.textContent="Яркость: "+h+"%")}}function n(e){g=!1;for(let t=0;t<f.length;t++)if(f[t].pointerId==e.pointerId){f.splice(t,1);break}}function o(e){let t=!1;return f.forEach(function(n){n.pointerId!=e.pointerId&&0==n.move&&(t=!0)}),t}}}function canvasVideo(e){function t(e,o,c,a,s){let l=0,d=0;if(o.width=v,o.height=m,c.width=v,c.height=m,!e.paused&&!e.ended){a.drawImage(e,0,0,v,m);let t=a.getImageData(0,0,v,m),o=t.data,c=s.getImageData(0,0,v,m),r=c.data,u=p/5+1,b=128*(1-u);for(let e=0;e<o.length;e+=4){let t=o[e],c=o[e+1],a=o[e+2];_&&(o[e]=_/5*t,o[e+1]=_/5*c,o[e+2]=_/5*a,t=o[e],c=o[e+1],a=o[e+2]),p&&(o[e]=o[e]*u+b,o[e+1]=o[e+1]*u+b,o[e+2]=o[e+2]*u+b,t=o[e],c=o[e+1],a=o[e+2]),t>255&&(o[e]=255),c>255&&(o[e+1]=255),a>255&&(o[e+2]=255),0>t&&(o[e]=0),0>c&&(o[e+1]=0),0>a&&(o[e+2]=0);let s=.299*t+.587*c+.114*a;if(50>s?l++:d++,100==e&&(i.style.color=l>d?"white":"black"),n){let t=o[e]+o[e+1]+o[e+2],c=n[e]+n[e+1]+n[e+2];(t-100>c||c>t+100)&&(r[e]=255,r[e+1]=0,r[e+2]=0)}}i.textContent=l>d?"dark":"light",n=o,t.data=o,c.data=r,a.putImageData(t,0,0),s.putImageData(c,0,0)}setTimeout(function(){requestAnimationFrame(function(){t(e,o,c,a,s)})},100)}let n,o=document.querySelector("#"+e),c=document.querySelector("#"+e+"-block"),i=c.querySelector(".canv-video-block__info"),a=c.querySelector(".canv-video-block__video"),s=c.querySelector(".canv-video-block__luminance"),l=c.querySelector(".canv-video-block__contrast"),d=c.querySelector(".canv-video-block__canvas-move"),r=a.getContext("2d",{alpha:!1}),u=d.getContext("2d",{alpha:!1}),v=o.offsetWidth,m=o.offsetHeight;o.style.display="none";let _=s.value;s.addEventListener("input",function(){_=s.value},!1);let p=l.value;l.addEventListener("input",function(){p=l.value},!1),t(o,a,d,r,u)}function canvasVideoSound(e){let t=window.AudioContext||window.webkitAudioContext;if(t){let n,o,c=document.querySelector("#"+e),i=document.querySelector("#"+e+"-block"),a=i.querySelector(".canv-video-block__sound-mute"),s=i.querySelector(".canv-video-block__video"),l=i.querySelector(".canv-video-block__sound-volume"),d=new t,r=d.createMediaElementSource(c),u=d.createAnalyser(),v=d.createScriptProcessor(2048,1,1),m=0;soundMuteButton(a,c),r.connect(u),r.connect(v),u.connect(d.destination),v.connect(d.destination),n=new Uint8Array(u.frequencyBinCount),v.onaudioprocess=function(){u.getByteFrequencyData(n),(o=getSoundVolumeValue(n))>m&&(m=o),drawSoundVolume(o,m,s,l)}}else alert("Ваш браузер не поддерживает Web Audio API")}function getSoundVolumeValue(e){let t=0;return e.forEach(e=>{t+=e}),t}function drawSoundVolume(e,t,n,o){let c=e*(n.offsetHeight/t);o.style.height=c+"px"}function createCanvasVideoBlock(e){let t=document.createElement("div"),n=document.createElement("div"),o=document.createElement("div"),c=document.createElement("div"),i=document.createElement("div"),a=document.createElement("span"),s=document.createElement("canvas"),l=document.createElement("span"),d=document.createElement("input"),r=document.createElement("span"),u=document.createElement("input"),v=document.createElement("canvas"),m=document.createElement("span");v.classList.add("canv-video-block__canvas-move"),t.classList.add("canv-video-block"),t.id=e+"-block",n.classList.add("canv-video-block__canvas-block"),o.classList.add("canv-video-block__controll-block"),a.classList.add("canv-video-block__button"),a.textContent="Все камеры",s.classList.add("canv-video-block__video"),c.classList.add("canv-video-block__sound-volume"),i.classList.add("canv-video-block__sound-mute"),i.textContent="♪",l.classList.add("canv-video-block__info"),d.classList.add("canv-video-block__luminance"),d.setAttribute("type","range"),d.setAttribute("value","5"),d.setAttribute("min","0"),d.setAttribute("max","10"),r.classList.add("canv-video-block__text"),r.textContent="Яркость",u.classList.add("canv-video-block__contrast"),u.setAttribute("type","range"),u.setAttribute("value","0"),u.setAttribute("min","-5"),u.setAttribute("max","5"),m.classList.add("canv-video-block__text"),m.textContent="Контраст",o.appendChild(r),o.appendChild(d),o.appendChild(m),o.appendChild(u),o.appendChild(a),o.appendChild(i),n.appendChild(l),n.appendChild(c),n.appendChild(s),n.appendChild(v),n.appendChild(o),t.appendChild(n),document.querySelector(".container").appendChild(t)}function initVideo(e,t){if(Hls.isSupported()){let n=new Hls;n.loadSource(t),n.attachMedia(e),n.on(Hls.Events.MANIFEST_PARSED,function(){e.play()})}}function openVideo(){document.querySelectorAll(".canv-video-block__video").forEach(function(e){e.addEventListener("click",function(){let e=this.parentNode,t=e.querySelector(".canv-video-block__controll-block"),n=e.querySelector(".canv-video-block__button"),o=e.querySelector(".canv-video-block__sound-volume");n.addEventListener("click",function(){e.classList.remove("canv-video-block__canvas-block_open"),n.classList.remove("canv-video-block__button_open"),n.classList.remove("canv-video-block__button_open"),t.classList.remove("canv-video-block__controll-block_open"),o.classList.remove("canv-video-block__sound-volume_active")}),e.classList.contains("canv-video-block__canvas-block_open")||(e.classList.add("canv-video-block__canvas-block_open"),n.classList.add("canv-video-block__button_open"),t.classList.add("canv-video-block__controll-block_open"),o.classList.add("canv-video-block__sound-volume_active"))})})}function soundMuteButton(e,t){e.addEventListener("click",function(){e.classList.contains("canv-video-block__sound-mute_active")?(t.muted=!0,e.classList.remove("canv-video-block__sound-mute_active")):(t.muted=!1,e.classList.add("canv-video-block__sound-mute_active"))})}function toggleMenu(){showMenu?(menu.classList.remove("header__menu_show"),menuBtn.classList.remove("header-mobile-btn_close"),menuBtnLine.forEach(e=>e.classList.remove("header-mobile-btn__line_close")),showMenu=!1):(menu.classList.add("header__menu_show"),menuBtn.classList.add("header-mobile-btn_close"),menuBtnLine.forEach(e=>e.classList.add("header-mobile-btn__line_close")),showMenu=!0)}const menu=document.querySelector(".header__menu"),menuBtn=document.querySelector(".header-mobile-btn"),menuBtnLine=document.querySelectorAll(".header-mobile-btn__line");var showMenu=!1;menuBtn.addEventListener("click",toggleMenu);